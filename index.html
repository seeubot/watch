<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Leaflet Colour Map – Custom Live & Pin Icons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    html, body { height:100%; margin:0; background:#f9f9f9; color:#222;}
    #map { width:100vw; height:100vh; position:absolute; top:0; left:0; }
    .fab {
      position:fixed; bottom:24px; left:26px; width:56px; height:56px;
      border-radius:50%; border:none; color:#fff; background:#1976d2; z-index:1102;
      display:flex; align-items:center; justify-content:center; font-size:2em;
      box-shadow:0 2px 14px #0003; cursor:pointer; transition: background .14s;
    }
    .fab:active { background:#0d47a1; }
    .leaflet-control, .leaflet-pane { filter:none; }
    .live-marker-anim { animation: livepulse 1.25s infinite;
      border-radius:50%; box-shadow:0 0 0 0 #1e88e5cc;
    }
    @keyframes livepulse {
      0% {box-shadow:0 0 0 0 #1e88e5cc;}
      70% {box-shadow:0 0 0 18px transparent;}
      100% {box-shadow:0 0 0 0 transparent;}
    }
    @media (max-width:600px){
      .fab { width:44px; height:44px; font-size:1.14em;}
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button id="center-btn" class="fab" title="Go to live location" aria-label="Go to live location">
    <svg width="26" height="26" viewBox="0 0 26 26" fill="none">
      <circle cx="13" cy="13" r="11" stroke="#fff" stroke-width="2"/>
      <circle cx="13" cy="13" r="5" fill="#fff" stroke="#1976d2" stroke-width="3"/>
      <g stroke="#1976d2" stroke-width="2">
        <line x1="13" x2="13" y1="0" y2="5"/>
        <line x1="13" x2="13" y1="21" y2="26"/>
        <line x1="0" x2="5" y1="13" y2="13"/>
        <line x1="21" x2="26" y1="13" y2="13"/>
      </g>
    </svg>
  </button>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Full-colour OpenStreetMap tiles
    const tile = L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      { attribution:'© OpenStreetMap contributors', maxZoom:19 }
    );
    const map = L.map("map", {
      zoomControl:true, attributionControl:true, layers:[tile]
    }).setView([20.59,78.96], 5);

    // Custom animated blue live marker
    function liveSVGIcon() {
      return L.divIcon({
        className:"live-marker-anim",
        iconSize:[40,40], iconAnchor:[20,20],
        html:`<svg width="40" height="40" viewBox="0 0 40 40">
          <circle cx="20" cy="20" r="16" fill="#1976d2" opacity="0.10"/>
          <circle cx="20" cy="20" r="12" fill="#1976d2" opacity="0.22"/>
          <circle cx="20" cy="20" r="8" fill="#1976d2" stroke="#fff" stroke-width="2"/>
        </svg>`
      });
    }

    // Custom colourful pin icon (teal, no red)
    const pinIcon = L.divIcon({
      className:"",
      iconSize:[38,38], iconAnchor:[19,38],
      html: `<svg viewBox="0 0 38 38" width="38" height="38">
        <ellipse cx="19" cy="24" rx="11" ry="9.8" fill="#fff" stroke="#009688" stroke-width="2.1"/>
        <circle cx="19" cy="16" r="7" fill="#009688" stroke="#116b5b" stroke-width="1.1"/>
      </svg>`
    });

    let liveMarker=null, userCircle=null, lastCoords=null, pinMarker=null;

    // Pin custom location on tap/click
    map.on('click', function(e) {
      if (pinMarker) map.removeLayer(pinMarker);
      pinMarker = L.marker(e.latlng, {icon:pinIcon})
                   .addTo(map)
                   .bindPopup("Delivery location").openPopup();
    });

    // Live GPS with blue animated marker, accuracy circle
    if ("geolocation" in navigator) {
      navigator.geolocation.watchPosition(
        pos=>{
          const {latitude:lat, longitude:lng, accuracy} = pos.coords;
          if (liveMarker) map.removeLayer(liveMarker);
          if (userCircle) map.removeLayer(userCircle);
          liveMarker = L.marker([lat,lng], {icon:liveSVGIcon()})
                         .addTo(map)
                         .bindPopup(`You're here!<br>Accuracy: ±${Math.round(accuracy)}m`);
          userCircle = L.circle([lat,lng], {
            radius:accuracy, color:'#1976d2', fillColor:'#90caf9', fillOpacity:0.12, opacity:0.19
          }).addTo(map);
          if (!lastCoords) map.setView([lat,lng], 17, {animate:true});
          lastCoords = { lat, lng };
        },
        ()=>{}, // Ignore errors (no toast)
        { enableHighAccuracy:true, maximumAge:0, timeout:12000 }
      );
    }

    // Live button behaviour: recenter + ripple highlight
    document.getElementById('center-btn').onclick = () => {
      if (lastCoords) {
        map.setView([lastCoords.lat, lastCoords.lng], map.getZoom(), { animate:true });
        if (liveMarker) {
          liveMarker._icon.classList.add("live-marker-anim");
          liveMarker.openPopup();
          setTimeout(()=>liveMarker._icon.classList.remove("live-marker-anim"), 1200);
        }
      }
    };
  </script>
</body>
</html>
