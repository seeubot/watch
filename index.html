<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Satellite Live Map – Advanced Live & Zoom UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    html, body { height:100%; margin:0; background:#151516; }
    #map { width:100vw; height:100vh; position:absolute; top:0; left:0; }
    .fab {
      position:fixed; bottom:24px; left:26px; width:58px; height:58px;
      border-radius:50%; border:none; color:#f3f3f3; background:#222;
      z-index:1102; display:flex; align-items:center; justify-content:center;
      font-size:2em; box-shadow:0 2px 14px #0007; cursor:pointer;
      transition: background .14s;
    }
    .fab:active { background:#555; }
    .zoom-dialog {
      position:fixed; right:26px; bottom:24px; width:170px; background:#222c;
      border-radius:14px; box-shadow:0 2px 16px #0007; z-index:1300;
      display:none; flex-direction:column; align-items:center; padding:1.6em 1.6em 1em 1.6em;
    }
    .zoom-dialog.active { display:flex; animation: pop-in .15s cubic-bezier(.7,.2,.18,.95); }
    .zoom-level-label {
      font:500 1.05em "Inter",Arial,sans-serif;
      color:#fff; letter-spacing:.01em; margin-bottom:.5em;
    }
    .zoom-slider {
      width:120px; margin:0.2em 0 0.7em 0; height:5px;
      background:#393941; border-radius:7px; position:relative;
    }
    .zoom-slider input[type="range"] {
      width:100%; height:22px; background:transparent; appearance:none; outline:none; margin:0;
    }
    .zoom-slider input[type="range"]::-webkit-slider-thumb {
      width:20px;height:20px;background:#fff;border-radius:50%;border:2.5px solid #232323;
      appearance:none; box-shadow:0 0 8px #0004;
    }
    .zoom-slider input[type="range"]::-moz-range-thumb {
      width:20px;height:20px;background:#fff;border-radius:50%;border:2.5px solid #232323;
      box-shadow:0 0 8px #0004;
    }
    .zoom-values {
      display:flex; width:120px; justify-content:space-between; font-size:.97em; color:#bbb;
      font-family:monospace; margin-bottom:.5em;
    }
    .dialog-close {
      width:38px; height:38px; border:none; border-radius:50%; background:#232325;
      color:#fff; font-size:1.23em; align-self:flex-end; cursor:pointer; margin-left:auto;
      transition:background .11s;
    }
    .dialog-close:active { background:#525258; }
    @keyframes pop-in { from { transform:scale(.77) translateY(35px); opacity:0;}
                         to { transform:scale(1) translateY(0); opacity:1;} }
    .leaflet-control, .leaflet-pane { filter: grayscale(1) contrast(1.19) brightness(.95); }
    /* Live marker animation */
    .live-marker-anim { animation: livepulse 1.25s infinite;
      border-radius:50%; box-shadow:0 0 0 0 #fff7;}
    @keyframes livepulse {
      0% {box-shadow:0 0 0 0 #fff8;}
      70% {box-shadow:0 0 0 24px transparent;}
      100% {box-shadow:0 0 0 0 transparent;}
    }
    @media (max-width:550px){
      .fab { width:42px; height:42px; font-size:1.13em;}
      .zoom-dialog { width:98vw; left:1vw; right:auto; bottom:17px; padding:1.2em .7em 1em .7em;}
      .zoom-values, .zoom-slider { width:90vw; max-width:250px;}
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button id="center-btn" class="fab" title="Go to live location" aria-label="Go to live location">
    <svg width="28" height="28" viewBox="0 0 38 38">
      <circle cx="19" cy="19" r="19" fill="#fff"/>
      <polygon points="19,7 23,30 19,25 15,30"
        fill="#232323" stroke="#151515" stroke-width="1.7"/>
    </svg>
  </button>
  <div id="zoom-dialog" class="zoom-dialog">
    <button class="dialog-close" title="Close" aria-label="Close">&times;</button>
    <div class="zoom-level-label">Map Zoom Level</div>
    <div class="zoom-values">
      <span id="zoom-min">1</span>
      <span id="zoom-current" style="color:#f8db3c;"></span>
      <span id="zoom-max">20</span>
    </div>
    <div class="zoom-slider">
      <input id="zoom-range" type="range" min="1" max="20" step="1">
    </div>
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Satellite-only tile layer (Esri World Imagery)
    const satelliteTiles = L.tileLayer(
      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", 
      { attribution:"Tiles © Esri, Maxar, Earthstar Geographics", maxZoom:20 }
    );
    const map = L.map("map", {
      zoomControl: false, attributionControl: true, layers: [satelliteTiles]
    }).setView([20.59, 78.96], 4);

    // Custom live marker (animated)
    function svgLiveMarker() {
      return L.divIcon({
        className: "live-marker-anim",
        iconSize: [38,38], iconAnchor: [19,19],
        html: `<svg viewBox="0 0 38 38" width="38" height="38">
          <circle cx="19" cy="19" r="19" fill="#fff" stroke="#232323" stroke-width="2.2"/>
          <circle cx="19" cy="19" r="9" fill="#232323" />
        </svg>`
      });
    }

    let liveMarker=null, liveCircle=null, lastCoords=null, pinMarker=null;

    map.on('click', function(e) {
      if (pinMarker) map.removeLayer(pinMarker);
      pinMarker = L.marker(e.latlng, {
        icon: L.divIcon({
          className:"",
          iconSize:[34,34], iconAnchor:[17,34],
          html:`<svg width="34" height="34" viewBox="0 0 36 36">
            <ellipse cx="18" cy="23.3" rx="11" ry="9.7" fill="#fff" stroke="#232323" stroke-width="2"/>
            <circle cx="18" cy="16" r="6" fill="#232323" stroke="#232323" stroke-width="1.5"/>
          </svg>`
        })
      }).addTo(map).bindPopup("Pinned location").openPopup();
    });

    if ("geolocation" in navigator) {
      navigator.geolocation.watchPosition(
        pos=>{
          const {latitude:lat, longitude:lng, accuracy} = pos.coords;
          if (liveMarker) map.removeLayer(liveMarker);
          if (liveCircle) map.removeLayer(liveCircle);
          liveMarker = L.marker([lat,lng], {icon:svgLiveMarker()})
                          .addTo(map)
                          .bindPopup(`You're here!<br>Accuracy: ±${Math.round(accuracy)}m`);
          liveCircle = L.circle([lat,lng], {
            radius:accuracy, color:'#b9b9b9', fillColor:'#fff', fillOpacity:0.08, opacity:0.18
          }).addTo(map);
          if (!lastCoords) {
            map.setView([lat,lng], 17, {animate:true});
          }
          lastCoords = { lat, lng };
        },
        ()=>{}, // Do nothing on error
        { enableHighAccuracy:true, maximumAge:0, timeout:12000 }
      );
    }

    // Live button recenters map to current position with a subtle highlight
    document.getElementById('center-btn').onclick = () => {
      if (lastCoords) {
        map.setView([lastCoords.lat, lastCoords.lng], map.getZoom(), { animate:true });
        if (liveMarker) {
          liveMarker._icon.classList.add("live-marker-anim");
          liveMarker.openPopup();
          setTimeout(()=>liveMarker._icon.classList.remove("live-marker-anim"), 1800);
        }
      }
    };

    // --- Zoom dialog box implementation ---
    const zoomDialog = document.getElementById("zoom-dialog");
    const zoomRange = document.getElementById("zoom-range");
    const zoomCurrent = document.getElementById("zoom-current");
    const zoomMin = map.getMinZoom(), zoomMax = map.getMaxZoom();
    zoomRange.min = zoomMin; zoomRange.max = zoomMax;
    document.getElementById("zoom-min").textContent = zoomMin;
    document.getElementById("zoom-max").textContent = zoomMax;

    // Show the dialog box on map double click or on pressing "Z"
    map.on("dblclick", () => showZoomDialog());
    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase()==="z") showZoomDialog();
    });

    // Dialog show/hide logic
    function showZoomDialog() {
      zoomDialog.classList.add("active");
      updateZoomDialog();
    }
    function hideZoomDialog() {
      zoomDialog.classList.remove("active");
    }
    document.querySelector(".dialog-close").onclick = hideZoomDialog;

    // Actual link between dialog and Leaflet zoom
    function updateZoomDialog() {
      const z = map.getZoom();
      zoomCurrent.textContent = z;
      zoomRange.value = z;
    }
    zoomRange.oninput = function() {
      map.setZoom(Number(this.value));
    };
    map.on("zoom", updateZoomDialog);

    // Always keep dialog current if open
    setInterval(() => {
      if (zoomDialog.classList.contains("active")) updateZoomDialog();
    }, 200);

  </script>
</body>
</html>
