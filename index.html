<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Location Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { 
            height: 100vh;
            width: 100%;
        }
        .accuracy-circle {
            stroke: #03a9f4;
            stroke-width: 1;
            fill: #03a9f480;
            fill-opacity: 0.2;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map with custom tile layer (OpenStreetMap)
        const map = L.map('map').setView([0, 0], 15); // Default view
        
        // Custom tile layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Create custom location marker
        const locationIcon = L.divIcon({
            className: 'live-location-pin',
            html: `<div style="position:relative">
                      <div style="background:#4285F4;border-radius:50%;width:16px;height:16px"></div>
                      <div style="position:absolute;top:0;left:0;width:16px;height:16px;border-radius:50%;border:2px solid #4285F4;animation:pulse 1.5s infinite"></div>
                   </div>`,
            iconSize: [20, 20],
            iconAnchor: [8, 8]
        });

        // Create elements for location tracking
        let marker = null;
        let accuracyCircle = null;
        let watchId = null;

        // CSS for animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); opacity: 1; }
                70% { transform: scale(3); opacity: 0; }
                100% { transform: scale(3); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Handle real-time location updates
        function onLocationFound(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            
            // Remove previous elements
            if (marker) map.removeLayer(marker);
            if (accuracyCircle) map.removeLayer(accuracyCircle);
            
            // Update map view
            map.setView([lat, lng], 18);
            
            // Add accuracy circle
            accuracyCircle = L.circle([lat, lng], {
                radius: accuracy,
                className: 'accuracy-circle'
            }).addTo(map);
            
            // Add new marker
            marker = L.marker([lat, lng], {icon: locationIcon})
                .addTo(map)
                .bindPopup(`Your location (Accuracy: ${Math.round(accuracy)} meters)`)
                .openPopup();
        }

        function onLocationError(error) {
            alert(`Location error (${error.code}): ${error.message}`);
        }

        // Start tracking
        function startTracking() {
            if (watchId !== null) return;
            
            watchId = navigator.geolocation.watchPosition(
                onLocationFound,
                onLocationError,
                {
                    enableHighAccuracy: true,
                    maximumAge: 10000,
                    timeout: 15000
                }
            );
        }

        // Stop tracking
        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }

        // Add control buttons
        const controlContainer = L.control({position: 'bottomleft'});
        controlContainer.onAdd = function() {
            const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            div.innerHTML = `
                <button id="start-track" style="padding:6px 12px;background:white;border:2px solid rgba(0,0,0,0.2);cursor:pointer">
                    ▶ Start Tracking
                </button>
                <button id="stop-track" style="padding:6px 12px;background:white;border:2px solid rgba(0,0,0,0.2);cursor:pointer;margin-left:5px">
                    ⏹ Stop Tracking
                </button>
            `;
            return div;
        };
        controlContainer.addTo(map);

        // Add button event handlers
        document.getElementById('start-track').addEventListener('click', startTracking);
        document.getElementById('stop-track').addEventListener('click', stopTracking);

        // Initial location request
        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);
        map.locate({setView: true, maxZoom: 16});
    </script>
</body>
</html>
