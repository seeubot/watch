<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Satellite GPS Map with Leaflet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    html, body { height: 100%; margin: 0; font-family: 'Segoe UI',sans-serif;}
    #map { height: 100vh; width: 100vw; }
    .floating-ui { position: absolute; z-index: 1000; top: 18px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(255,255,255,0.92); border-radius: 16px;  box-shadow: 0 4px 16px rgba(0,0,0,0.15); padding: 12px 18px;}
    .floating-ui button { background: #00bfae; color: #fff; border: none; border-radius: 18px; padding: 8px 20px; font-size: 1rem; cursor: pointer; transition: background 0.2s; box-shadow: 0 2px 6px rgba(44,98,180,0.10); }
    .floating-ui button.active, .floating-ui button:hover { background: #00887a; }
    .address-display { position: absolute; bottom: 28px; left: 50%; transform: translateX(-50%); padding: 12px 20px; border-radius: 14px; min-width: 240px; background: rgba(255,255,255,0.98); box-shadow: 0 2px 10px rgba(0,0,0,0.10); font-size: 1rem; color: #222; z-index: 1000; text-align: center; max-width: calc(100vw - 36px); word-break: break-word; font-weight: 500;}
    /* Custom Map Marker - animated pulse effect */
    .custom-marker {
      width: 32px; height: 32px; border-radius: 50%; background: #28a5a5; box-shadow: 0 0 0 rgba(40,165,165,0.6); animation: pulse 1.8s infinite;
      display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.2em; border: 2px solid #fff;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(40,165,165,0.3);}
      70% { box-shadow: 0 0 0 14px rgba(40,165,165,0);}
      100% { box-shadow: 0 0 0 0 rgba(40,165,165,0);}
    }
    @media (max-width: 600px) { .floating-ui { flex-direction: column; top: 7px; left: 50%; transform: translateX(-50%); } .address-display { font-size: .95rem; padding: 8px 8px; } }
  </style>
</head>
<body>
  <!-- Map Controls -->
  <div class="floating-ui">
    <button id="liveBtn" class="active">Live Location</button>
    <button id="pinBtn">Pin Location</button>
  </div>
  <!-- Address Output -->
  <div id="address" class="address-display">Loading locationâ€¦</div>
  <!-- Map -->
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // --- Custom Marker as DivIcon ---
    function getLiveIcon() {
      return L.divIcon({
        className: '',
        html: "<div class='custom-marker'><i class='fas fa-crosshairs'></i></div>",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -16]
      });
    }
    function getPinIcon() {
      return L.divIcon({
        className: '',
        html: "<div class='custom-marker' style='background:#f15555;'><i class='fas fa-map-pin'></i></div>",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -16]
      });
    }

    // --- Map Logic ---
    let map, liveMarker, pinMarker, currentMode, watchId;
    const addressDisplay = document.getElementById('address');
    const liveBtn = document.getElementById('liveBtn');
    const pinBtn = document.getElementById('pinBtn');

    // Reverse geocode helper (Nominatim)
    async function reverseGeocode(lat, lon) {
      const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=jsonv2&email=test@example.com`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network');
        const data = await res.json();
        return data.display_name || 'No address found';
      } catch (e) {
        return 'Reverse geocoding failed';
      }
    }
    function updateAddress(lat, lon, address) {
      addressDisplay.innerHTML = `<div><b>Lat:</b> ${lat.toFixed(6)}<br><b>Lng:</b> ${lon.toFixed(6)}</div>
      <div style="margin-top:7px;color:#555;"><span style="font-size:0.97em;">ðŸ”Ž </span>${address}</div>`;
    }
    // Center and update marker/address for live location
    function centerToLiveLocation(e) {
      const lat = e.coords.latitude, lon = e.coords.longitude;
      if (!map) return;
      map.setView([lat, lon], 16, { animate: true });
      if (liveMarker) liveMarker.setLatLng([lat, lon]);
      else liveMarker = L.marker([lat, lon], {icon: getLiveIcon()}).addTo(map);
      if (pinMarker) { map.removeLayer(pinMarker); pinMarker = null; }
      reverseGeocode(lat, lon).then(addr => updateAddress(lat, lon, addr));
    }
    function onGeoError(e) {
      addressDisplay.textContent = `Unable to get GPS: ${e.message || e}`;
    }
    function activateLiveMode() {
      liveBtn.classList.add('active'); pinBtn.classList.remove('active');
      currentMode = 'live';
      if (watchId) navigator.geolocation.clearWatch(watchId);
      watchId = navigator.geolocation.watchPosition(centerToLiveLocation, onGeoError, {enableHighAccuracy:true,timeout:6000});
      map.off('click');
    }
    function activatePinMode() {
      pinBtn.classList.add('active'); liveBtn.classList.remove('active');
      currentMode = 'pin';
      if (watchId) { navigator.geolocation.clearWatch(watchId); watchId = null; }
      map.once('click', async function(e){
        const lat = e.latlng.lat, lon = e.latlng.lng;
        if (pinMarker) pinMarker.setLatLng([lat, lon]);
        else pinMarker = L.marker([lat, lon], {icon: getPinIcon()}).addTo(map);
        if (liveMarker) { map.removeLayer(liveMarker); liveMarker = null; }
        map.setView([lat, lon], 16, { animate: true });
        let addr = await reverseGeocode(lat, lon);
        updateAddress(lat, lon, addr);
      });
      addressDisplay.textContent = "Tap on map to pin a location.";
    }
    liveBtn.onclick = activateLiveMode;
    pinBtn.onclick = activatePinMode;

    // --- Initialize map with Satellite tiles ---
    window.onload = function() {
      map = L.map('map', { zoomControl: true }).setView([18.5214, 73.8544], 13);
      // ESRI World Imagery tile layer [1][3]:
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
        maxZoom: 20
      }).addTo(map);
      activateLiveMode();
    };
  </script>
</body>
</html>
