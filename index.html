<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Universal Video Player</title>
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
</head>
<body>
  <h3>Streaming URL:</h3>
  <input type="text" id="urlInput"
         value="https://xenophobic-hali-school1660440-2ed04e4c.koyeb.app/dl/689740fb0dc4ac1ee4952470"
         style="width:90%;" />
  <button onclick="loadVideo()">Play</button>

  <video
    id="player"
    class="video-js vjs-default-skin"
    width="640"
    height="360"
    controls
    preload="auto"></video>

  <label for="audioTracksSelect">Audio Track:</label>
  <select id="audioTracksSelect"></select>

  <script>
    let player = videojs('player', {
      techOrder: ['html5'],
    });

    function loadVideo() {
      let url = document.getElementById('urlInput').value;
      // Reset player
      player.reset();
      if (url.endsWith('.m3u8')) {
        // HLS.js integration for m3u8
        if (Hls.isSupported()) {
          let hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(player.el().querySelector('video'));
          hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
            loadAudioTracks(hls.audioTracks);
            player.play();
          });
          // Listen for audio track changes
          document.getElementById('audioTracksSelect').onchange = function(e) {
            hls.audioTrack = e.target.value;
          };
        } else if (player.el().querySelector('video').canPlayType('application/vnd.apple.mpegurl')) {
          player.src({type: 'application/x-mpegURL', src: url});
          player.play();
        } else {
          alert('HLS not supported.');
        }
      } else {
        // Standard video formats (mp4, mkv, ts)
        player.src({type: 'video/mp4', src: url});
        player.play();
      }
    }

    function loadAudioTracks(tracks) {
      let select = document.getElementById('audioTracksSelect');
      select.innerHTML = '';
      tracks.forEach((track, idx) => {
        let opt = document.createElement('option');
        opt.value = idx;
        opt.text = track.name || track.lang || 'Track ' + (idx + 1);
        select.appendChild(opt);
      });
    }
  </script>
</body>
</html>
