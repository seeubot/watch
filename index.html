<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Real-Time Location Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f7f7fa;
    }
    #map {
      height: 100vh;
      width: 100vw;
    }
    .loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 2em 3em;
      font-size: 1.3em;
      z-index: 9999;
      box-shadow: 0 2px 12px rgba(100,100,100,0.1);
      display: none;
    }
    #center-btn {
      position: absolute;
      top: 1em;
      right: 1em;
      background: #4a90e2;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 52px;
      height: 52px;
      font-size: 1.7em;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: background 0.2s;
    }
    #center-btn:active {
      background: #357ab8;
    }
    @media (max-width: 600px) {
      #map { height: 100vh; }
      #center-btn { top: 0.75em; right: 0.75em; width: 44px; height:44px; font-size:1.2em; }
    }
  </style>
</head>
<body>
  <div id="loader" class="loader">Getting your location...</div>
  <div id="map"></div>
  <button id="center-btn" aria-label="Re-center map">üìç Center</button>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const loader = document.getElementById('loader');
    loader.style.display = 'block';
    const map = L.map('map').setView([0,0], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OSM contributors'
    }).addTo(map);

    let userMarker = null, userCircle = null;
    let lastCoords = null;

    function updateMap(coords, accuracy) {
      if (userMarker) map.removeLayer(userMarker);
      if (userCircle) map.removeLayer(userCircle);
      userMarker = L.marker([coords.latitude, coords.longitude], {
        icon: L.icon({
          iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
          iconSize: [38, 38],
          iconAnchor: [19, 38]
        })
      }).addTo(map).bindPopup(`You're within ${Math.round(accuracy)} meters.`);
      userCircle = L.circle([coords.latitude, coords.longitude], {
        radius: accuracy,
        color: '#4a90e2',
        fillColor: '#7ebeff55',
        fillOpacity: 0.3
      }).addTo(map);
      map.setView([coords.latitude, coords.longitude], 16);
      lastCoords = coords;
    }

    function showToast(msg) {
      const toast = document.createElement('div');
      toast.className = 'loader';
      toast.style.padding = "1em 2em";
      toast.textContent = msg;
      toast.style.zIndex = 99999;
      document.body.appendChild(toast);
      toast.style.display = 'block';
      setTimeout(() => {
        toast.style.display = 'none';
        document.body.removeChild(toast);
      }, 2500);
    }

    if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition(
        position => {
          loader.style.display = 'none';
          updateMap(position.coords, position.coords.accuracy);
        },
        error => {
          loader.textContent = "Location error: " + error.message;
          showToast("Location error: " + error.message);
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 }
      );
    } else {
      loader.textContent = "Geolocation not supported.";
    }

    document.getElementById('center-btn').onclick = () => {
      if (lastCoords) {
        map.setView([lastCoords.latitude, lastCoords.longitude], 16);
        if (userMarker) userMarker.openPopup();
      }
    };
  </script>
</body>
</html>
