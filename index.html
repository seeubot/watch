<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Real-Time Location Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: #f5f6fa;
      color: #222;
      box-sizing: border-box;
    }
    #map {
      height: 100vh;
      width: 100vw;
      position: absolute;
      left: 0; top: 0;
      z-index: 1;
    }
    .loader {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      border-radius: 14px;
      padding: 2em 3em;
      font-size: 1.15em;
      box-shadow: 0 2px 12px rgba(80,80,80,0.06);
      z-index: 2001;
      display: none;
      font-weight: 500;
    }
    /* Bottom navigation bar */
    .bottom-nav {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      display: flex; justify-content: space-around;
      background: #fff;
      border-top: 1px solid #ececec;
      height: 56px;
      z-index: 1300;
      box-shadow: 0 1px 14px rgba(44,85,138,0.03);
    }
    .nav-btn {
      flex: 1;
      border: none;
      background: none;
      font: inherit;
      color: #8d8d8d;
      font-size: 1.1em;
      padding: 0;
      outline: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: color 0.1s;
      cursor: pointer;
      height: 100%;
    }
    .nav-btn.active {
      color: #4a90e2;
      font-weight: bold;
      background: #f3f8fe;
    }
    /* Floating action button (FAB) */
    .fab {
      position: fixed;
      bottom: 72px;
      right: 16px;
      width: 56px;
      height: 56px;
      font-size: 2.1em;
      background: #4a90e2;
      color: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(54,129,228,0.19);
      z-index: 1500;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background .18s;
      cursor: pointer;
    }
    .fab:active { background: #357ab8; }
    /* Status/Info Bottom Card */
    .bottom-card {
      position: fixed;
      left: 50%;
      bottom: 68px;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 14px rgba(80,80,80,0.08);
      padding: 1em 2.4em;
      min-width: 180px;
      min-height: 50px;
      z-index: 1200;
      font-size: 1em;
      display: none;
      align-items: center;
      gap: 0.7em;
      color: #357ab8;
    }
    /* Toast for feedback */
    .toast {
      position: fixed;
      bottom: 130px;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      color: #fff;
      font-size: 1em;
      border-radius: 8px;
      padding: 1em 2em;
      opacity: 0;
      z-index: 2003;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }
    /* Responsive styles */
    @media (max-width: 600px) {
      #map { height: 100vh; }
      .fab {
        width: 44px; height: 44px; bottom: 66px; font-size: 1.6em;
      }
      .bottom-nav { height: 49px; }
      .bottom-card { padding: 1em 1.1em; min-width: 130px; font-size: .95em; }
      .toast { padding: .7em 1.3em; bottom: 100px; font-size: 0.98em; }
    }
  </style>
</head>
<body>
  <div id="loader" class="loader">Getting your location‚Ä¶</div>
  <div id="map"></div>
  <!-- Info card for status/accuracy -->
  <div id="bottom-card" class="bottom-card"></div>
  <!-- Floating action button for recentering -->
  <button id="center-btn" class="fab" aria-label="Re-center map">üìç</button>
  <!-- Toast message -->
  <div id="toast" class="toast"></div>
  <!-- Bottom navigation bar -->
  <nav class="bottom-nav" aria-label="primary">
    <button class="nav-btn active" tabindex="0" aria-label="Home">
      <span>üè†</span>
      <span style="font-size:.82em;">Home</span>
    </button>
    <button class="nav-btn" tabindex="0" aria-label="Location">
      <span>üìå</span>
      <span style="font-size:.82em;">Location</span>
    </button>
    <button class="nav-btn" tabindex="0" aria-label="Orders">
      <span>üõí</span>
      <span style="font-size:.82em;">Orders</span>
    </button>
    <button class="nav-btn" tabindex="0" aria-label="Profile">
      <span>üë§</span>
      <span style="font-size:.82em;">Profile</span>
    </button>
  </nav>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // UI elements
    const loader = document.getElementById('loader');
    const toast = document.getElementById('toast');
    const bottomCard = document.getElementById('bottom-card');
    loader.style.display = 'block';

    // Map setup
    const map = L.map('map', { zoomControl: false, attributionControl: true }).setView([0,0], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OSM contributors'
    }).addTo(map);

    let userMarker = null, userCircle = null;
    let lastCoords = null;

    // UX: Custom marker icon
    const userIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40],
    });

    function showToast(msg, duration = 2500) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), duration);
    }

    function animateBottomCard(show, msg = '') {
      if (show && msg) {
        bottomCard.style.display = 'flex';
        bottomCard.textContent = msg;
      } else {
        bottomCard.style.display = 'none';
      }
    }

    function updateMap(coords, accuracy, isInitial = false) {
      if (userMarker) map.removeLayer(userMarker);
      if (userCircle) map.removeLayer(userCircle);
      userMarker = L.marker([coords.latitude, coords.longitude], {icon: userIcon})
        .addTo(map)
        .bindPopup(`You're within ${Math.round(accuracy)} meters.`);
      userCircle = L.circle([coords.latitude, coords.longitude], {
        radius: accuracy,
        color: '#4a90e2',
        fillColor: '#7ebeff55',
        fillOpacity: 0.29
      }).addTo(map);
      if (isInitial) {
        map.setView([coords.latitude, coords.longitude], 16);
      }
      lastCoords = coords;
      animateBottomCard(true, `Accuracy: ¬±${Math.round(accuracy)} m`);
    }

    // Geolocation logic
    let isFirst = true;
    if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition(
        position => {
          loader.style.display = 'none';
          updateMap(position.coords, position.coords.accuracy, isFirst);
          isFirst = false;
          showToast("Location found!");
        },
        error => {
          loader.textContent = "Location error: " + error.message;
          animateBottomCard(true, "Location error!");
          showToast("Location error: " + error.message, 3400);
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 }
      );
    } else {
      loader.textContent = "Geolocation not supported.";
      animateBottomCard(true, "Geolocation not supported.");
    }

    // Recenter FAB logic
    document.getElementById('center-btn').onclick = () => {
      if (lastCoords) {
        map.setView([lastCoords.latitude, lastCoords.longitude], 16, { animate: true });
        if (userMarker && userMarker.getPopup()) userMarker.openPopup();
        showToast("Centered on your location!", 1700);
      }
    };

    // Bottom navigation: for demonstration only, highlight active on click
    document.querySelectorAll('.nav-btn').forEach(btn =>
      btn.addEventListener('click', function() {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        showToast(`Switched to "${this.ariaLabel}"`);
      })
    );

    // UX: Hide status card after 6s
    setInterval(() => {
      animateBottomCard(false);
    }, 6000);
  </script>
</body>
</html>
